{% extends 'base.html' %}

{% block title %}Dashboard - BabyGrow{% endblock %}

{% block content %}
<div class="container animate-fadeIn">
    <!-- Welcome Header -->
    <div style="margin-bottom: var(--space-xl);">
        <h1 style="margin-bottom: var(--space-xs);">Halo! ðŸ‘‹</h1>
        <p class="text-muted">Selamat datang kembali di BabyGrow</p>
    </div>
    
    <!-- Stats Cards -->
    <div class="grid grid-4" style="margin-bottom: var(--space-xl);">
        <div class="card stagger-item">
            <div class="card-icon peach">ðŸ‘¶</div>
            <div class="card-value" style="margin-top: var(--space-md);">{{ total_children }}</div>
            <div class="card-label">Total Anak</div>
        </div>
        
        <div class="card stagger-item">
            <div class="card-icon mint">ðŸ“Š</div>
            <div class="card-value" style="margin-top: var(--space-md);">
                {% set total_mile = namespace(count=0) %}
                {% for m in milestone_data %}
                    {% set total_mile.count = total_mile.count + (m.done or m[3] or 0) %}
                {% endfor %}
                {{ total_mile.count|int }}
            </div>
            <div class="card-label">Milestone Tercapai</div>
        </div>
        
        <div class="card stagger-item">
            <div class="card-icon blush">ðŸ’‰</div>
            <div class="card-value" style="margin-top: var(--space-md);">
                {% set total_vacc = namespace(count=0) %}
                {% for i in immunization_data %}
                    {% set total_vacc.count = total_vacc.count + (i.done or i[3] or 0) %}
                {% endfor %}
                {{ total_vacc.count|int }}
            </div>
            <div class="card-label">Vaksin Selesai</div>
        </div>
        
        <div class="card stagger-item">
            <div class="card-icon lavender">ðŸ’Œ</div>
            <div class="card-value" style="margin-top: var(--space-md);">0</div>
            <div class="card-label">Kapsul Waktu</div>
        </div>
    </div>
    
    {% if total_children == 0 %}
    <!-- Empty State -->
    <div class="card empty-state">
        <div class="empty-state-icon">ðŸ‘¶</div>
        <h3 class="empty-state-title">Belum ada data anak</h3>
        <p class="empty-state-text">Tambahkan data anak pertama Anda untuk mulai memantau pertumbuhan dan perkembangan si kecil.</p>
        <a href="{{ url_for('add_child') }}" class="btn btn-primary btn-lg">
            <i class="bi bi-plus-circle"></i> Tambah Anak
        </a>
    </div>
    {% else %}
    
    <div class="grid grid-2">
        <!-- Latest Growth -->
        <div class="card stagger-item">
            <div class="card-header">
                <h3 class="card-title"><i class="bi bi-graph-up"></i> Pertumbuhan Terakhir</h3>
            </div>
            {% if latest_growth %}
                <ul style="list-style: none; padding: 0; margin: 0;">
                    {% for g in latest_growth %}
                    <li class="flex justify-between items-center" style="padding: var(--space-sm) 0; border-bottom: 1px solid var(--color-peach);">
                        <div>
                            <strong>{{ g.name or g[1] }}</strong>
                            <div class="text-sm text-muted">{{ g.record_date or g[4] }}</div>
                        </div>
                        <div class="flex gap-sm">
                            {% if g.weight or g[2] %}
                            <span class="badge badge-success">{{ g.weight or g[2] }} kg</span>
                            {% endif %}
                            {% if g.height or g[3] %}
                            <span class="badge badge-pending">{{ g.height or g[3] }} cm</span>
                            {% endif %}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted text-center" style="padding: var(--space-lg);">
                    Belum ada data pertumbuhan
                </p>
            {% endif %}
        </div>
        
        <!-- Milestone Progress -->
        <div class="card stagger-item">
            <div class="card-header">
                <h3 class="card-title"><i class="bi bi-star"></i> Progress Milestone</h3>
            </div>
            {% if milestone_data %}
                <ul style="list-style: none; padding: 0; margin: 0;">
                    {% for m in milestone_data %}
                    {% set total = m.total or m[2] or 0 %}
                    {% set done = m.done or m[3] or 0 %}
                    {% set progress = ((done / total * 100) if total > 0 else 0)|int %}
                    <li style="padding: var(--space-sm) 0; border-bottom: 1px solid var(--color-peach);">
                        <div class="flex justify-between" style="margin-bottom: var(--space-xs);">
                            <strong>{{ m.name or m[1] }}</strong>
                            <span class="text-sm text-muted">{{ done|int }}/{{ total|int }}</span>
                        </div>
                        <div class="progress">
                            <div class="progress-bar" style="width: {{ progress }}%;"></div>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="text-muted text-center" style="padding: var(--space-lg);">
                    Belum ada data milestone
                </p>
            {% endif %}
        </div>
    </div>
    {% endif %}
</div>

<!-- Floating Action Button -->
<a href="{{ url_for('add_child') }}" class="fab" title="Tambah Anak">
    <i class="bi bi-plus-lg"></i>
</a>
{% endblock %}
